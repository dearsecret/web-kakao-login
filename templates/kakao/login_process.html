<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>로그인 처리 중...</title>
  <style>
    body { display:flex; height:100vh; justify-content:center; align-items:center; flex-direction:column; background:#121212; color:#fff; font-family:Arial; }
    #message { margin-top:1rem; }
    #error { color: #ff5c5c; font-weight: bold; }
  </style>
</head>
<body>
  <h1>카카오 로그인 처리 중입니다...</h1>
  <p id="message">잠시만 기다려 주세요.</p>

  <script>
    const API_LOGIN_URL = "{{ api_login_url|escapejs }}";
    const CODE = "{{ code|escapejs }}";
    const STATE = "{{ state|escapejs }}";

    async function processLogin() {


      try {
        const res = await fetch(API_LOGIN_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json', 'X-CSRFToken': document.cookie.match(/csrftoken=([^;]+)/)?.[1] || ''},
          credentials: 'include',
          body: JSON.stringify({ code: CODE, state: STATE }),
        });
        const data = await res.json();
        if(data.success){
          document.getElementById('message').textContent = '로그인 성공! 페이지 이동 중...';
          window.location.href = data.redirect_url || '/';
        } else {
          document.getElementById('message').textContent = '로그인 실패: ' + (data.error || '알 수 없는 오류');
        }
      } catch(e) {
        document.getElementById('message').textContent = '네트워크 오류: ' + e.message;
      }
    }
    processLogin();
  </script>
</body>
</html>

